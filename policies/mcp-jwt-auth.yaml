###############################################################################
# MCP Authentication â€” Okta JWT Validation
# Validates JWTs on MCP tool routes. Unauthenticated requests are rejected
# before reaching any MCP tool server.
#
# JWKS fetched from Okta via AgentgatewayBackend (okta-jwks).
###############################################################################
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: mcp-jwt-auth
  namespace: agentgateway-system
  labels:
    category: authentication
    demo: agentgateway
  annotations:
    description: >-
      Enforces Okta JWT validation on MCP routes. Only authenticated
      users/agents with valid tokens can access MCP tools.
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: mcp-github
  backend:
    mcp:
      authentication:
        issuer: "https://integrator-7147223.okta.com/oauth2/default"
        audiences:
        - "api://default"
        mode: Strict
        jwks:
          backendRef:
            group: agentgateway.dev
            kind: AgentgatewayBackend
            name: okta-jwks
            port: 443
          jwksPath: "/oauth2/default/v1/keys"
