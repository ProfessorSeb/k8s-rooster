sequenceDiagram
    participant Client as MCP Client
    participant AGW as AgentGateway Proxy
    participant STS as Token Exchange Server
    participant UI as Solo Enterprise UI
    participant OAuth as External OAuth Provider
    participant API as Upstream API

    Client->>AGW: Request (needs upstream OAuth token)
    AGW->>STS: Request upstream token
    STS-->>AGW: Elicitation URL (PENDING)
    AGW-->>Client: Return elicitation URL (PENDING)
    
    Note over Client,UI: User opens elicitation URL
    Client->>UI: Open URL & authorize
    UI->>OAuth: Redirect for OAuth authorization
    OAuth-->>UI: Redirect back with auth code
    UI->>STS: Complete elicitation with code
    STS->>STS: Store token (COMPLETED)
    
    Note over Client,API: Retry with stored credentials
    Client->>AGW: Retry request
    AGW->>STS: Fetch stored token
    STS-->>AGW: Return stored token
    AGW->>API: Forward request + inject OAuth token
    API-->>AGW: Response
    AGW-->>Client: Return response âœ…
