apiVersion: v1
data:
  ca.crt: '-----BEGIN CERTIFICATE-----

    MIIBiTCCAS+gAwIBAgIQLiokCanbgMqWaBHm1QLlvTAKBggqhkjOPQQDAjAVMRMw

    EQYDVQQKEwprdWJlcm5ldGVzMB4XDTI2MDEyNDAxMDU0N1oXDTM2MDEyMjAxMDU0

    N1owFTETMBEGA1UEChMKa3ViZXJuZXRlczBZMBMGByqGSM49AgEGCCqGSM49AwEH

    A0IABNSxNJOJNAYwHUIxikEGDSUEan2ydn9bTSdLXVEvilUUshCruuHWPdvYUVcO

    K/LA4cXgtqtEyVj5gpKzXqWqY/WjYTBfMA4GA1UdDwEB/wQEAwIChDAdBgNVHSUE

    FjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4E

    FgQUPXrFvLDysyUo74aAowhfjmdlqjwwCgYIKoZIzj0EAwIDSAAwRQIgIhYrmm5A

    SbRqCPCRT93BjRn0fBES21Xy80KZmNKhwJUCIQC5BXvcxbYFqLUGiKi3MF/zjtZB

    jFrUtYJZ3aSjVZt8ag==

    -----END CERTIFICATE-----

    '
kind: ConfigMap
metadata:
  annotations:
    kubernetes.io/description: Contains a CA bundle that can be used to verify the
      kube-apiserver when using internal endpoints such as the internal service IP
      or kubernetes.default.svc. No other usage is guaranteed across distributions
      of Kubernetes clusters.
  name: kube-root-ca.crt
  namespace: agentgateway-system

---
apiVersion: v1
data:
  00-default-config.yaml: "macros:\n  replica:\n    '@from_env': CLICKHOUSE_REPLICA_ID\n\
    \  shard:\n    '@from_env': CLICKHOUSE_SHARD_ID\n\nlogger:\n  level: information\n\
    \  console: 1\n\nhttp_port: 8123\ntcp_port: 9000\ninterserver_http_port: 9009\n\
    mysql_port: null\npostgresql_port: null\n\nlisten_host: 0.0.0.0\nlisten_host:\
    \ \"::\"\nlisten_try: 1\n\nremote_servers:\n  default:\n    shard:\n      - replica:\n\
    \          - host: management-clickhouse-shard0-0.management-clickhouse-headless\n\
    \            port: 9000\n\nmerge_tree:\n  storage_policy: default\n"
  99-custom-config.yaml: 'concurrent_threads_soft_limit_num: 1

    mark_cache_size: 524288000

    '
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: management
    meta.helm.sh/release-namespace: agentgateway-system
  labels:
    app.kubernetes.io/component: clickhouse
    app.kubernetes.io/instance: management
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.9.3-alpine
    helm.sh/chart: clickhouse-0.0.4
  name: management-clickhouse-config
  namespace: agentgateway-system

---
apiVersion: v1
data:
  00-profiles.yaml: "profiles:\n  default:\n    '@replace': \"1\"\n    input_format_parallel_parsing:\
    \ 0\n    max_block_size: 8192\n    max_download_threads: 1\n    output_format_parallel_formatting:\
    \ 0\n"
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: management
    meta.helm.sh/release-namespace: agentgateway-system
  labels:
    app.kubernetes.io/component: clickhouse
    app.kubernetes.io/instance: management
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 25.9.3-alpine
    helm.sh/chart: clickhouse-0.0.4
  name: management-clickhouse-users-config
  namespace: agentgateway-system

---
apiVersion: v1
data:
  config.yaml: 'config: {}

    '
kind: ConfigMap
metadata:
  labels:
apiVersion: v1
data:
  config: "{\n  \"roleMapper\": \"claims.Groups.transformList(i, v, v in rolesMap,\
    \ rolesMap[v])\",\n  \"roleMappings\": {\"admins\":\"global.Admin\",\"readers\"\
    :\"global.Reader\",\"writers\":\"global.Writer\"}\n}\n"
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: management
    meta.helm.sh/release-namespace: agentgateway-system
  labels:
    app.kubernetes.io/managed-by: Helm
  name: rbac-config-management
  namespace: agentgateway-system

---
apiVersion: v1
data:
  relay: "extensions:\n  health_check:\n    endpoint: ${env:MY_POD_IP}:13133\nexporters:\n\
    \  clickhouse/k8sobjects:\n    endpoint: tcp://management-clickhouse.agentgateway-system.svc.cluster.local:9000?dial_timeout=10s\n\
    \    username: default\n    password: password\n    async_insert: true\n    ttl:\
    \ 2160h\n    compress: lz4\n    create_schema: false\n    logs_table_name: otel_k8sobjects_json\n\
    \    timeout: 10s\n    retry_on_failure:\n      enabled: true\n      initial_interval:\
    \ 5s\n      max_interval: 30s\n      max_elapsed_time: 300s\nprocessors:\n  batch:\n\
    \    send_batch_max_size: 3000\n    send_batch_size: 2000\n    timeout: 600ms\n\
    \n  memory_limiter:\n    check_interval: 1s\n    limit_percentage: 85\n    spike_limit_percentage:\
    \ 10\n\n  resource/cluster_context:\n    attributes:\n      - key: \"cluster_name\"\
    \n        action: insert\n        value: \"maniak-rooster\"\n\n  # Mark logs as\
    \ k8sobjects to distinguish from other log sources\n  attributes/k8sobjects:\n\
    \    actions:\n      - key: k8sobjects\n        action: upsert\n        value:\
    \ true\n\nreceivers:\n  k8sobjects:\n    error_mode: ignore\n    include_initial_state:\
    \ true\n    objects:\n      # kagent.dev\n      - name: agents\n        mode:\
    \ watch\n        group: kagent.dev\n      - name: memories\n        mode: watch\n\
    \        group: kagent.dev\n      - name: modelconfigs\n        mode: watch\n\
    \        group: kagent.dev\n      - name: teams\n        mode: watch\n       \
    \ group: kagent.dev\n      - name: toolservers\n        mode: watch\n        group:\
    \ kagent.dev\n      # agentgateway resources\n      - name: agentgatewaybackends\n\
    \        mode: watch\n        group: agentgateway.dev\n      # Istio networking.istio.io\n\
    \      - name: virtualservices\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: destinationrules\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: gateways\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: serviceentries\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: sidecars\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: envoyfilters\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: workloadentries\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: workloadgroups\n        mode: watch\n        group: networking.istio.io\n\
    \      - name: proxyconfigs\n        mode: watch\n        group: networking.istio.io\n\
    \      # Istio security.istio.io\n      - name: authorizationpolicies\n      \
    \  mode: watch\n        group: security.istio.io\n      - name: peerauthentications\n\
    \        mode: watch\n        group: security.istio.io\n      - name: requestauthentications\n\
    \        mode: watch\n        group: security.istio.io\n      # Istio telemetry.istio.io\n\
    \      - name: telemetries\n        mode: watch\n        group: telemetry.istio.io\n\
    \      # Istio extensions.istio.io\n      - name: wasmplugins\n        mode: watch\n\
    \        group: extensions.istio.io\n      # Standard Kubernetes core resources\n\
    \      - name: namespaces\n        mode: watch\n      - name: services\n     \
    \   mode: watch\n      - name: pods\n        mode: watch\n      - name: nodes\n\
    \        mode: watch\n      - name: endpoints\n        mode: watch\n      - name:\
    \ configmaps\n        mode: watch\n      - name: serviceaccounts\n        mode:\
    \ watch\n      # Standard Kubernetes apps resources\n      - name: deployments\n\
    \        mode: watch\n        group: apps\n      - name: replicasets\n       \
    \ mode: watch\n        group: apps\n      - name: statefulsets\n        mode:\
    \ watch\n        group: apps\n      - name: daemonsets\n        mode: watch\n\
    \        group: apps\n      # Kubernetes autoscaling resources\n      - name:\
    \ horizontalpodautoscalers\n        mode: watch\n        group: autoscaling\n\
    \      # Kubernetes discovery.k8s.io resources\n      - name: endpointslices\n\
    \        mode: watch\n        group: discovery.k8s.io\n      # Kubernetes Gateway\
    \ API gateway.networking.k8s.io\n      - name: gateways\n        mode: watch\n\
    \        group: gateway.networking.k8s.io\n      - name: gatewayclasses\n    \
    \    mode: watch\n        group: gateway.networking.k8s.io\n      - name: httproutes\n\
    \        mode: watch\n        group: gateway.networking.k8s.io\n      - name:\
    \ grpcroutes\n        mode: watch\n        group: gateway.networking.k8s.io\n\
    \      - name: tcproutes\n        mode: watch\n        group: gateway.networking.k8s.io\n\
    \      - name: tlsroutes\n        mode: watch\n        group: gateway.networking.k8s.io\n\
    \      - name: referencegrants\n        mode: watch\n        group: gateway.networking.k8s.io\n\
    \      - name: udproutes\n        mode: watch\n        group: gateway.networking.k8s.io\n\
    \      - name: backendtlspolicies\n        mode: watch\n        group: gateway.networking.k8s.io\n\
    \      # Kubernetes networking.k8s.io resources\n      - name: ingresses\n   \
    \     mode: watch\n        group: networking.k8s.io\n      - name: networkpolicies\n\
    \        mode: watch\n        group: networking.k8s.io\n      # Kubernetes apiextensions.k8s.io\
    \ resources\n      - name: customresourcedefinitions\n        mode: watch\n  \
    \      group: apiextensions.k8s.io\n      # kgateway resources\n      - name:\
    \ trafficpolicies\n        mode: watch\n        group: gateway.kgateway.dev\n\
    \      - name: httplistenerpolicies\n        mode: watch\n        group: gateway.kgateway.dev\n\
    \      - name: backendconfigpolicies\n        mode: watch\n        group: gateway.kgateway.dev\n\
    \      # gloo.solo.io resources\n      - name: glootrafficpolicies\n        mode:\
    \ watch\n        group: gloo.solo.io\n\nservice:\n  telemetry:\n    logs:\n  \
    \    encoding: json\n    metrics:\n      readers:\n      - pull:\n          exporter:\n\
    \            prometheus:\n              host: '0.0.0.0'\n              port: 8888\n\
    \  extensions:\n    - health_check\n  pipelines:\n    # Pipeline for local Kubernetes\
    \ objects - exports directly to ClickHouse\n    logs/objects:\n      receivers:\n\
    \        - k8sobjects\n      processors:\n        - memory_limiter\n        -\
    \ resource/cluster_context\n        - attributes/k8sobjects\n        - batch\n\
    \      exporters:\n        - clickhouse/k8sobjects"
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: management
    meta.helm.sh/release-namespace: agentgateway-system
  labels:
    app.kubernetes.io/managed-by: Helm
  name: solo-enterprise-k8sobjects-config
  namespace: agentgateway-system

---
apiVersion: v1
data:
  relay: "extensions:\n  health_check:\n    endpoint: ${env:MY_POD_IP}:13133\nexporters:\n\
    \  clickhouse/k8sobjects:\n    endpoint: tcp://management-clickhouse.agentgateway-system.svc.cluster.local:9000?dial_timeout=10s\n\
    \    username: default\n    password: password\n    async_insert: true\n    ttl:\
    \ 2160h\n    compress: lz4\n    create_schema: false\n    logs_table_name: otel_k8sobjects_json\n\
    \    timeout: 10s\n    retry_on_failure:\n      enabled: true\n      initial_interval:\
    \ 5s\n      max_interval: 30s\n      max_elapsed_time: 300s\n  clickhouse/telemetry:\n\
    \    endpoint: tcp://management-clickhouse.agentgateway-system.svc.cluster.local:9000?dial_timeout=10s\n\
    \    username: default\n    password: password\n    async_insert: true\n    ttl:\
    \ 2160h\n    compress: lz4\n    create_schema: false\n    logs_table_name: otel_logs_json\n\
    \    traces_table_name: otel_traces_json\n    timeout: 10s\n    retry_on_failure:\n\
    \      enabled: true\n      initial_interval: 5s\n      max_interval: 30s\n  \
    \    max_elapsed_time: 300s\n  clickhouse/metrics:\n    endpoint: tcp://management-clickhouse.agentgateway-system.svc.cluster.local:9000?dial_timeout=10s\n\
    \    username: default\n    password: password\n    async_insert: true\n    ttl:\
    \ 2160h\n    compress: lz4\n    create_schema: false\n    timeout: 10s\n    metrics_tables:\n\
    \      gauge:\n        name: \"otel_metrics_gauge\"\n      sum:\n        name:\
    \ \"otel_metrics_sum\"\n      summary:\n        name: \"otel_metrics_summary\"\
    \n      histogram:\n        name: \"otel_metrics_histogram\"\n      exponential_histogram:\n\
    \        name: \"otel_metrics_exp_histogram\"\n    retry_on_failure:\n      enabled:\
    \ true\n      initial_interval: 5s\n      max_interval: 30s\n      max_elapsed_time:\
    \ 300s\nprocessors:\n  batch:\n    send_batch_max_size: 3000\n    send_batch_size:\
    \ 2000\n    timeout: 600ms\n\n  memory_limiter:\n    check_interval: 1s\n    limit_percentage:\
    \ 85\n    spike_limit_percentage: 10\n\n  resource/cluster_context:\n    attributes:\n\
    \      - key: \"cluster_name\"\n        action: insert\n        value: \"maniak-rooster\"\
    \n\n  attributes/k8sobjects:\n    actions:\n      - key: k8sobjects\n        value:\
    \ true\n        action: upsert\n\n  k8sattributes:\n    auth_type: \"serviceAccount\"\
    \n    passthrough: false\n    extract:\n      metadata:\n        - k8s.pod.name\n\
    \        - k8s.pod.uid\n        - k8s.deployment.name\n        - k8s.daemonset.name\n\
    \        - k8s.namespace.name\n        - k8s.node.name\n        - k8s.pod.start_time\n\
    \    pod_association:\n      - sources:\n          - from: resource_attribute\n\
    \            name: k8s.pod.ip\n      - sources:\n          - from: resource_attribute\n\
    \            name: k8s.pod.uid\n      - sources:\n          - from: connection\n\
    \n  # Filter to keep only GenAI instrumentations for kagent and agentgateway pipelines.\n\
    \  # Enable tracing.verbose to disable this filter.\n  filter/genai:\n    traces:\n\
    \      span:\n        - 'not(IsMatch(instrumentation_scope.name, \"^gcp\\\\.vertex\\\
    \\.agent$\") or IsMatch(instrumentation_scope.name, \"^opentelemetry\\\\.instrumentation\\\
    \\.openai\\\\.v1$\") or IsMatch(instrumentation_scope.name, \"^opentelemetry\\\
    \\.instrumentation\\\\.anthropic$\") or IsMatch(instrumentation_scope.name, \"\
    ^opentelemetry\\\\.instrumentation\\\\.google-generativeai$\") or IsMatch(instrumentation_scope.name,\
